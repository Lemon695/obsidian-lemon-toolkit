# Lemon Toolkit

一个为 Obsidian 设计的个人效率工具包插件，提供实用的辅助功能。

## 功能特性

### 复制路径命令

通过键盘快捷键快速复制各种格式的文件路径：

- **复制相对路径** - 复制相对于仓库根目录的文件路径
- **复制绝对路径** - 复制完整的系统路径（仅桌面端）
- **复制文件名** - 复制带扩展名的文件名
- **复制文件名（无扩展名）** - 复制不带扩展名的文件名

所有命令都会显示确认通知，展示已复制的内容。

### 删除文件命令

提供两种文件删除选项：

- **永久删除文件** - 从仓库中永久删除当前文件
- **删除文件到回收站** - 将当前文件移动到 Obsidian 回收站（.trash 文件夹）

### 文件管理命令

- **复制文件** - 复制当前文件并弹出重命名对话框。默认文件名包含后缀（如时间戳：`filename-1733234567890.md` 或 UUID：`filename-a1b2c3d4.md`），可在确认前修改
- **移动文件到文件夹** - 将当前文件移动到指定文件夹，带智能历史记录。文件夹列表优先显示最近使用的文件夹，支持输入筛选。插件会自动追踪所有文件移动操作（包括拖拽和 Obsidian 原生移动）

### 标签管理命令

- **查看当前标签** - 在弹窗中显示当前文件的所有标签。点击任意标签可复制到剪贴板
- **插入标签** - 在光标位置插入标签，支持多选。标签按使用频率或最近使用时间排序（可在设置中配置）。包含搜索筛选功能，快速查找标签。插件会自动追踪你在笔记中手动输入的标签

### 命令面板

- **打开命令面板** - 打开专属的命令面板，仅显示 Lemon Toolkit 的命令。命令按最近使用时间排序，固定的命令始终显示在最上面。支持模糊搜索和使用统计
- **打开设置** - 快速打开插件设置页面，修改配置

### 文件信息视图

- **打开文件信息** - 打开侧边栏视图，显示当前文件的完整信息：
  - 基础信息（文件名、路径、日期、大小、字数、阅读时间）
  - Frontmatter 字段，格式化显示
  - 所有标签（可点击搜索）
  - 出链和入链（可点击跳转）
  - 文件位置面包屑导航
  - 切换文件或修改内容时自动更新
  - 点击文件名/路径可复制

### 智能最近文件

- **打开最近文件** - 打开智能侧边栏视图，管理你的最近文件：
  - **三个标签页**：最近编辑、最近查看、最近新增
  - **固定文件** - 将常用文件固定到顶部，快速访问
  - **时间显示** - 显示每个文件的最后访问时间（如 "2小时前"、"3天前"）
  - **右键菜单** - 快捷操作：固定/取消固定、在新标签页打开、在导航中显示、移动或删除
  - **自动追踪** - 自动追踪文件的编辑、查看和创建记录
  - **简洁界面** - 现代化、有序的 UI 设计，清晰的视觉层次

### 链接转换工具

在 Wiki 链接和 Markdown 链接之间转换，支持预览和选择：

- **转换 wiki 链接为 markdown（文件）** - 将整个文件中的所有 `[[wiki 链接]]` 转换为 `[markdown](链接)`
- **转换 markdown 链接为 wiki（文件）** - 将整个文件中的所有 `[markdown](链接)` 转换为 `[[wiki 链接]]`
- **转换 wiki 链接为 markdown（选区）** - 仅转换选中的 wiki 链接
- **转换 markdown 链接为 wiki（选区）** - 仅转换选中的 markdown 链接

**功能特性**：
- 转换前预览，支持复选框选择
- 保留别名：`[[链接|别名]]` → `[别名](./链接.md)`
- 智能图片处理：图片保留原始扩展名（`.png`、`.jpg` 等）
- Typora 兼容路径：使用相对路径如 `./folder/file.md` 或 `../_resources/image.png`
- 自动路径解析：在仓库中查找文件并计算正确的相对路径
- 类型筛选：快速选择/取消选择所有图片、视频或文档
- 转换为 wiki 链接时跳过外部链接（http/https）
- 显示行号和转换前后对比

### 智能粘贴

根据可配置的规则自动转换剪贴板内容：

- **智能粘贴** - 在光标位置粘贴剪贴板内容，自动应用规则

**功能特性**：
- **智能格式检测**：自动读取剪贴板的 HTML 格式（如果可用），保留链接和格式
- **HTML 转 Markdown**：自动将富文本转换为 Markdown 格式
- 使用正则表达式配置多个转换规则
- 单独启用/禁用规则
- 应用前使用示例文本测试规则
- 调整规则顺序控制应用顺序
- 内置微博时间线图片移除规则
- 支持捕获组进行高级替换

**支持的 HTML 元素**：
- 链接 (`<a>`) → `[text](url)`
- 图片 (`<img>`) → `![alt](src)`
- 粗体/斜体 (`<strong>`, `<em>`) → `**text**`, `*text*`
- 标题 (`<h1>`-`<h6>`) → `# text`
- 列表 (`<ul>`, `<ol>`) → `- item`, `1. item`
- 代码 (`<code>`, `<pre>`) → `` `code` ``, ` ```code``` `
- 引用 (`<blockquote>`) → `> text`

**使用场景示例**：
- 从网页/APP 复制带链接的内容，自动转换为 Markdown
- 从复制的网页内容中移除不需要的图片
- 清理外部来源的格式
- 自动转换 URL 或链接
- 去除跟踪参数
- 规范化空格或换行符

### 时刻记录器

快速时间戳记录，适用于日记和时间追踪：

- **插入时刻（自动）** - 智能插入：追加到现有时刻块或在光标处插入
- **插入时刻（光标位置）** - 始终在光标位置插入（手动模式）

**功能特性**：
- **智能检测**：自动查找文档中现有的时刻记录块
- **自动追加**：新时刻自动添加到时间线末尾
- **手动覆盖**：使用"光标位置"命令可在文档任意位置插入
- **自定义格式**：在设置中配置时间戳格式（默认：`YYYY-MM-DD HH:mm:ss`）
- **即时输入**：光标自动定位到时间戳后，可立即输入描述

**使用示例**：
```markdown
- 2024-12-04 09:01:12 开始上班
- 2024-12-04 10:30:45 团队会议
- 2024-12-04 12:00:00 午餐休息
- 2024-12-04 14:15:30 代码审查
- 2024-12-04 18:00:00 下班
```

**工作原理**：
1. 首次使用：在光标位置创建新时刻条目
2. 后续使用：自动追加到现有时刻块
3. 需要在其他位置插入？使用"插入时刻（光标位置）"命令

### 智能复制

基于文档结构的智能内容复制：

- **复制当前标题部分** - 复制光标所在标题及其下所有内容
- **复制当前代码块** - 复制光标位置的代码块
- **复制当前表格** - 复制光标位置的表格
- **智能复制选择器** - 可视化选择器，可选择并复制多个块
- **选择代码块复制** - 从整个文档中选择多个代码块
- **选择代码行复制** - 从当前代码块中选择特定行
- **选择表格行复制** - 从当前表格中选择特定行

**功能特性**：
- **上下文感知**：自动检测光标所在内容类型（标题、代码、表格）
- **多选支持**：一次选择多个不连续的块进行复制
- **类型筛选**：快速选择所有标题、代码块或表格
- **可视化预览**：复制前查看内容预览
- **智能组合**：多个选择会以适当间距组合

**支持的内容类型**：
- **标题**：复制整个章节，包括所有子章节
- **代码块**：复制完整代码块及语言标签
- **表格**：复制完整表格及格式
- **列表**：复制列表结构（即将推出）

**使用场景**：
- 从长文档中提取特定章节
- 一次复制多个代码示例
- 组合不连续的内容进行分享
- 无需精确文本选择的快速复制

**示例工作流**：
1. 将光标放在标题中
2. 运行"复制当前标题部分"
3. 整个章节（包括子章节）复制到剪贴板

或使用选择器：
1. 运行"智能复制选择器"
2. 勾选多个标题和代码块
3. 点击"复制选中"
4. 所有选中内容组合并复制

**API 文档示例**：
```markdown
## 请求
```json
{ "user": "john" }
```

## 响应
```json
{ "status": "ok" }
```
```

使用"选择代码块复制"：
1. 打开选择器显示所有代码块
2. 勾选两个 JSON 块
3. 一次性复制，自动添加空行分隔
4. 完美适合分享 API 示例！

### Frontmatter 编辑器

- **编辑 Frontmatter** - 打开模态对话框编辑 frontmatter 字段，无需进入编辑模式：
  - 查看和编辑所有 frontmatter 字段
  - 添加新字段并选择类型
  - 删除现有字段
  - 搜索/筛选字段
  - 常用操作的快捷按钮
  - 类型感知编辑（字符串、数字、布尔值、日期、数组）
  - 自动保存并验证

### 选中文本快捷操作

- **文本选择操作** - 选中文本后的快捷操作（选中文本后运行命令）：
  - 用选中文本创建新笔记（替换为链接）
  - 全局搜索选中文本
  - 包裹为 [[wiki-link]]
  - 包裹为 callout（多种类型）
  - 添加为标签
  - 复制为引用格式
  - 发送/追加到其他文件

### 外部应用打开

- **外部应用管理** - 配置外部应用程序打开文件和文件夹：
  - 在设置中添加自定义应用程序（名称、路径）
  - 配置应用是否可以打开文件/文件夹
  - 自动为每个应用生成命令
  - 支持 macOS、Windows、Linux
  - 可添加任意数量的应用程序

### 标题序号管理

- **添加/更新标题序号** - 自动为所有标题添加或更新层级序号：
  - 支持多级序号（1、1.1、1.2、1.2.1 等）
  - 应用前预览更改
  - 高亮显示修改的标题
  - 保留标题文本内容
  - 智能识别已有序号
  - 自动跳过代码块
  
- **移除标题序号** - 移除文档中所有标题的序号

- **用一级标题重命名文件** - 根据文档中第一个一级标题重命名文件：
  - 自动查找文档中第一个 `# 标题`
  - 将文件重命名为标题文本
  - 跳过代码块中的标题
  - 自动清理非法文件名字符（如 `/:*?"<>|`）
  - 如果文件名已匹配标题则显示提示

- **重命名文件** - 通过模态对话框重命名当前文件：
  - 在可编辑输入框中显示当前文件名
  - **智能推荐**基于你的重命名历史：
    - 分析最近的重命名模式（最近 30 天）
    - 检测后缀/前缀添加（例如："- DataviewJS"、"草稿 - "）
    - 按频率和最近使用时间排序推荐
    - 显示每个模式的使用次数
  - **快捷推荐**：
    - 添加时间戳：`filename-20250106`
    - 添加日期前缀：`20250106-filename`
    - 添加 Unix 时间戳：`filename-1733456789`
    - 添加短 UUID：`filename-a1b2c3d4`
  - 点击任意推荐即可快速应用
  - 自动清理非法字符
  - 历史记录本地存储（最多 500 条，保留 90 天）

### 命令统计与分析

- **显示统计数据** - 打开全面的分析仪表板，追踪你的命令使用情况和生产力：

**功能特性**：
- **四个分析视图**：
  - **概览**：一目了然的关键指标和今日活动摘要
  - **命令**：每个命令的详细统计信息，支持排序的表格
  - **效率**：时间节省分析，显示你节省了多少时间
  - **趋势**：使用模式的可视化图表和热力图

- **智能追踪**：
  - 自动追踪所有命令执行
  - 记录每次使用的时间戳
  - 基于预估的手动操作时间计算效率提升
  - 批量存储写入，优化性能

- **深度洞察指标**：
  - 执行的命令总数（与上一周期对比）
  - 最常用命令及可视化条形图
  - 每个命令节省的时间和累计总数
  - 每个命令的日均使用次数
  - 最近 30 天的使用趋势
  - 按星期几和小时显示使用热力图

- **数据管理**：
  - 导出统计数据为 JSON 格式，用于外部分析
  - 确认后清除所有数据
  - 可配置的数据保留期限
  - 注重隐私：所有数据本地存储

- **专业 UI**：
  - 固定尺寸的模态窗口（900x700px），体验一致
  - 平滑的标签切换，无布局跳动
  - Material Design 风格界面
  - 响应式图表和可视化

**示例洞察**：
- "你今天执行了 156 个命令，比昨天多 23%"
- "智能复制是你本周最常用的功能，使用了 45 次"
- "本月你通过自动化命令节省了 2.5 小时"
- "使用高峰时段：工作日下午 2-4 点"

**使用场景**：
- 追踪你最常使用的功能
- 量化生产力提升
- 识别工作流模式
- 优化命令使用
- 用时间节省数据证明插件价值

## 使用方法

1. 在仓库中打开任意文件
2. 打开命令面板（Ctrl/Cmd + P）
3. 搜索 "Lemon Toolkit" 命令
4. 选择需要的复制命令
5. 内容将被复制到剪贴板，并显示确认通知

### 命令列表

| 命令 | 说明 |
|------|------|
| `Lemon Toolkit: Copy relative path` | 复制相对于仓库根目录的文件路径 |
| `Lemon Toolkit: Copy absolute path` | 复制完整的系统路径 |
| `Lemon Toolkit: Copy file name` | 复制带扩展名的文件名 |
| `Lemon Toolkit: Copy file name (no extension)` | 复制不带扩展名的文件名 |
| `Lemon Toolkit: Delete file permanently` | 永久删除当前文件 |
| `Lemon Toolkit: Delete file to trash` | 将当前文件移动到 Obsidian 回收站 |
| `Lemon Toolkit: Duplicate file` | 复制当前文件并弹出重命名对话框 |
| `Lemon Toolkit: Move file to folder` | 将当前文件移动到指定文件夹（带智能历史记录） |
| `Lemon Toolkit: View current tags` | 查看当前文件的所有标签 |
| `Lemon Toolkit: Insert tags` | 在光标位置插入标签 |
| `Lemon Toolkit: Open command palette` | 打开 Lemon Toolkit 命令面板 |
| `Lemon Toolkit: Open settings` | 打开插件设置页面 |
| `Lemon Toolkit: Open file info` | 打开文件信息侧边栏 |
| `Lemon Toolkit: Edit frontmatter` | 在模态对话框中编辑 frontmatter 字段 |
| `Lemon Toolkit: Text selection actions` | 选中文本的快捷操作 |
| `Lemon Toolkit: Add/update heading numbering` | 添加或更新标题的层级序号 |
| `Lemon Toolkit: Remove heading numbering` | 移除所有标题序号 |
| `Lemon Toolkit: Rename file from H1 heading` | 根据一级标题重命名文件 |
| `Lemon Toolkit: Rename file` | 通过模态对话框重命名当前文件 |
| `Lemon Toolkit: Show Statistics` | 打开命令使用分析仪表板 |

## 安装方法

### 从 Obsidian 社区插件安装

1. 打开 **设置** → **第三方插件**
2. 选择 **浏览** 并搜索 "Lemon Toolkit"
3. 选择 **安装**
4. 安装完成后，选择 **启用**

### 手动安装

1. 从 [Releases](https://github.com/yourusername/lemon-toolkit/releases) 页面下载最新版本
2. 将文件解压到仓库的插件文件夹：`<vault>/.obsidian/plugins/lemon-toolkit/`
3. 重新加载 Obsidian
4. 在 **设置** → **第三方插件** 中启用该插件

## 设置

在 **设置** → **Lemon Toolkit** 中可以配置：

### 复制文件

- **复制文件后缀类型** - 选择复制文件时添加的后缀格式
  - 时间戳（默认）：`filename-1733234567890.md`
  - UUID：`filename-a1b2c3d4.md`

### 移动文件

- **文件夹列表排序方式** - 选择移动文件时文件夹列表的排序方式
  - 最近使用（默认）：最近移动过的文件夹显示在最上面
  - 最近 24 小时使用最多：按最近一天内的移动次数排序
  - 最近 7 天使用最多：按最近一周内的移动次数排序
  - 最近 30 天使用最多：按最近一个月内的移动次数排序

注意：插件会自动追踪所有文件移动操作，包括拖拽、右键移动和 Obsidian 原生文件操作。

### 标签

- **标签列表排序方式** - 选择插入标签时标签列表的排序方式
  - 最近使用（默认）：最近使用的标签显示在最上面
  - 最近 24 小时使用最多：按最近一天内的使用次数排序
  - 最近 7 天使用最多：按最近一周内的使用次数排序
  - 最近 30 天使用最多：按最近一个月内的使用次数排序
  - 字母顺序：按字母顺序排序标签

注意：插件会自动追踪你在笔记中手动输入的标签，不仅限于使用插入标签命令时。

### 命令面板

- **固定命令** - 选择要固定在命令面板顶部的命令。固定的命令将始终显示在最前面，其后是最近使用的命令

### 文件信息视图

- **显示阅读时间** - 根据字数显示预估阅读时间（默认：启用）
- **日期时间格式** - 自定义日期和时间的显示格式（默认：YYYY-MM-DD HH:mm）

### Frontmatter 编辑器

- **显示类型图标** - 在字段名旁显示类型图标（默认：启用）
- **保存后关闭** - 保存后自动关闭编辑器（默认：禁用）
- **日期格式** - 日期字段的格式（默认：YYYY-MM-DD）

### 外部应用

- **管理外部应用** - 配置外部应用程序列表
  - 添加应用名称和完整路径
  - 选择是否可以打开文件
  - 选择是否可以打开文件夹
  - 保存后自动生成对应命令

## 兼容性

- 最低 Obsidian 版本：1.0.0
- 支持桌面端（Windows、macOS、Linux）
- 支持移动端（iOS、Android），部分功能受限
  - 注意：移动设备上无法使用绝对路径复制功能

## 开发

本插件使用 TypeScript 构建，采用模块化架构，易于扩展。

### 构建插件

```bash
# 安装依赖
npm install

# 开发模式（带监听）
npm run dev

# 生产构建
npm run build
```

### 项目结构

```
src/
├── main.ts              # 插件入口
├── settings.ts          # 插件设置接口
├── commands/
│   ├── index.ts         # 命令注册
│   ├── copyPath.ts      # 复制路径功能实现
│   ├── deleteFile.ts    # 删除文件功能实现
│   ├── duplicateFile.ts # 复制文件功能实现
│   ├── moveFile.ts      # 移动文件功能实现
│   ├── tags.ts          # 标签管理功能实现
│   ├── commandPalette.ts # 命令面板功能实现
│   └── openSettings.ts  # 打开设置功能实现
├── views/
│   └── FileInfoView.ts  # 文件信息侧边栏视图
├── ui/
│   ├── DuplicateFileModal.ts # 重命名复制文件的弹窗
│   ├── MoveFileModal.ts      # 移动文件的弹窗（带历史记录）
│   ├── ViewCurrentTagsModal.ts # 查看当前标签的弹窗
│   ├── InsertTagsModal.ts    # 插入标签的弹窗
│   ├── CommandPaletteModal.ts # Lemon Toolkit 命令面板弹窗
│   ├── PinnedCommandsModal.ts # 管理固定命令的弹窗
│   └── SettingTab.ts         # 插件设置面板
└── utils/
    ├── clipboard.ts     # 剪贴板工具
    └── suffix.ts        # 后缀生成工具
```

## 支持

如果遇到任何问题或有功能建议，请在 GitHub 上[提交 issue](https://github.com/Lemon695/obsidian-lemon-toolkit/issues)。

## 许可证

MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 致谢

基于 [Obsidian API](https://docs.obsidian.md) 构建。
